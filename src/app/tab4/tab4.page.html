<ion-header [translucent]="true">
  <ion-toolbar color="success">
    <ion-title>
      <div class="header-content">
        <div class="header-left">
          <strong>AGRODATA</strong>
        </div>
        <div class="header-right">
          <span>RANCHO LA VAQUITA FELIZ</span>
          <span class="notification-count">{{ unreadCount }} NOTIFICACIONES</span>
          <ion-icon name="notifications-outline"></ion-icon>
          <ion-icon name="log-out-outline" (click)="logout()" class="logout-btn"></ion-icon>
        </div>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="notifications-content">
  <!-- Segmentos de navegación -->
  <div class="segments-container">
    <ion-segment [value]="activeTab" (ionChange)="onTabChange($event)">
      <ion-segment-button value="notifications">
        <ion-icon name="notifications-outline"></ion-icon>
        <ion-label>Notificaciones</ion-label>
        <ion-badge *ngIf="unreadCount > 0" color="danger" class="segment-badge">
          {{ unreadCount }}
        </ion-badge>
      </ion-segment-button>

      <ion-segment-button value="settings">
        <ion-icon name="settings-outline"></ion-icon>
        <ion-label>Configuración</ion-label>
      </ion-segment-button>
      
      <ion-segment-button value="info">
        <ion-icon name="information-circle-outline"></ion-icon>
        <ion-label>Información</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Tab de Notificaciones -->
  <div *ngIf="activeTab === 'notifications'" class="notifications-tab">
    <!-- Acciones rápidas -->
    <div class="quick-actions" *ngIf="notifications.length > 0">
      <ion-button fill="clear" size="small" (click)="markAllAsRead()" [disabled]="unreadCount === 0">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Marcar todas como leídas
      </ion-button>
      <ion-button fill="clear" size="small" color="danger" (click)="clearAllNotifications()">
        <ion-icon name="trash-outline" slot="start"></ion-icon>
        Limpiar todo
      </ion-button>
    </div>

    <!-- Lista de notificaciones -->
    <div class="notifications-list">
      <ion-card *ngFor="let notification of notifications" 
               class="notification-card" 
               [class.unread]="!notification.leida"
               (click)="markAsRead(notification)">
        <ion-card-content>
          <div class="notification-header">
            <div class="notification-icon" [style.background-color]="getNotificationColor(notification.tipo)">
              <ion-icon [name]="getNotificationIcon(notification.tipo)"></ion-icon>
            </div>
            <div class="notification-main">
              <div class="notification-title-section">
                <h3 class="notification-title">{{ notification.titulo }}</h3>
                <ion-badge [color]="getPriorityColor(notification.prioridad)" class="priority-badge">
                  {{ notification.prioridad }}
                </ion-badge>
              </div>
              <p class="notification-message">{{ notification.mensaje }}</p>
              <div class="notification-meta">
                <span class="notification-time">{{ formatNotificationTime(notification.fecha, notification.hora) }}</span>
                <span *ngIf="notification.animalNombre" class="notification-animal">
                  • {{ notification.animalNombre }}
                </span>
              </div>
            </div>
            <div class="notification-actions">
              <ion-button fill="clear" size="small" color="danger" 
                         (click)="deleteNotification(notification); $event.stopPropagation()">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Mensaje cuando no hay notificaciones -->
      <div *ngIf="notifications.length === 0" class="no-notifications">
        <ion-icon name="notifications-outline"></ion-icon>
        <h3>No hay notificaciones</h3>
        <p>Todas las notificaciones aparecerán aquí</p>
      </div>
    </div>
  </div>

  <!-- Tab de Configuración -->
  <div *ngIf="activeTab === 'settings'" class="settings-tab">
    <!-- Configuración de notificaciones -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="notifications-outline"></ion-icon>
          Configuración de Notificaciones
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-icon name="heart-outline" slot="start" color="danger"></ion-icon>
            <ion-label>
              <h3>Alertas de Celo</h3>
              <p>Notificar cuando se detecte celo</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.celoAlerts" 
              (ionChange)="onSettingChange('celoAlerts')">
            </ion-toggle>
          </ion-item>

          <ion-item>
            <ion-icon name="medical-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Recordatorios de Vacunación</h3>
              <p>Alertas para vacunas pendientes</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.vacunacionReminders" 
              (ionChange)="onSettingChange('vacunacionReminders')">
            </ion-toggle>
          </ion-item>

          <ion-item>
            <ion-icon name="flower-outline" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>Seguimiento de Inseminación</h3>
              <p>Recordatorios de IA programadas</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.inseminacionTracking" 
              (ionChange)="onSettingChange('inseminacionTracking')">
            </ion-toggle>
          </ion-item>

          <ion-item>
            <ion-icon name="person-outline" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>Alertas de Parto</h3>
              <p>Notificar fechas probables de parto</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.partoAlerts" 
              (ionChange)="onSettingChange('partoAlerts')">
            </ion-toggle>
          </ion-item>

          <ion-item>
            <ion-icon name="settings-outline" slot="start" color="medium"></ion-icon>
            <ion-label>
              <h3>Notificaciones del Sistema</h3>
              <p>Alertas de respaldo y actualizaciones</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.systemNotifications" 
              (ionChange)="onSettingChange('systemNotifications')">
            </ion-toggle>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Configuración de sonido y vibración -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="phone-portrait-outline"></ion-icon>
          Configuración de Dispositivo
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-label>
              <h3>Sonido</h3>
              <p>Reproducir sonido con las notificaciones</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.soundEnabled" 
              (ionChange)="onSettingChange('soundEnabled')">
            </ion-toggle>
          </ion-item>

          <ion-item>
            <ion-label>
              <h3>Vibración</h3>
              <p>Vibrar con las notificaciones</p>
            </ion-label>
            <ion-toggle 
              [(ngModel)]="settings.vibrationEnabled" 
              (ionChange)="onSettingChange('vibrationEnabled')">
            </ion-toggle>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Acciones de configuración -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Acciones</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <ion-button expand="block" fill="outline" color="primary" (click)="exportData()">
                <ion-icon name="cloud-offline-outline" slot="start"></ion-icon>
                Exportar Datos
              </ion-button>
            </ion-col>
            <ion-col size="6">
              <ion-button expand="block" fill="outline" color="warning" (click)="resetSettings()">
                <ion-icon name="settings-outline" slot="start"></ion-icon>
                Restablecer
              </ion-button>
            </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="12">
          <ion-button expand="block" color="danger" class="logout-main-btn" (click)="logout()">
            <ion-icon name="log-out-outline" slot="start"></ion-icon>
            Cerrar Sesión
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-card-content>
</ion-card>
  </div>

  <!-- Tab de Información -->
  <div *ngIf="activeTab === 'info'" class="info-tab">
    <!-- Información del usuario -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="person-outline"></ion-icon>
          Información del Usuario
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="user-info">
          <ion-avatar class="user-avatar">
            <ion-icon name="person-outline"></ion-icon>
          </ion-avatar>
          <div class="user-details">
            <h2>{{ currentUser }}</h2>
            <p>RANCHO LA VAQUITA FELIZ</p>
            <ion-note>Usuario activo</ion-note>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Estadísticas de la aplicación -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="paw-outline"></ion-icon>
          Estadísticas del Rancho
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <div class="stat-item">
                <ion-icon name="paw-outline" color="primary"></ion-icon>
                <div class="stat-info">
                  <span class="stat-number">{{ appInfo.totalAnimals }}</span>
                  <span class="stat-label">Animales</span>
                </div>
              </div>
            </ion-col>
            <ion-col size="6">
              <div class="stat-item">
                <ion-icon name="calendar-outline" color="success"></ion-icon>
                <div class="stat-info">
                  <span class="stat-number">{{ appInfo.totalEvents }}</span>
                  <span class="stat-label">Eventos</span>
                </div>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Información técnica -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="information-circle-outline"></ion-icon>
          Información Técnica
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-label>
              <h3>Versión de la App</h3>
              <p>{{ appInfo.version }}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h3>Fecha de Compilación</h3>
              <p>{{ appInfo.buildDate }}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-icon name="server-outline" slot="start" color="medium"></ion-icon>
            <ion-label>
              <h3>Base de Datos</h3>
              <p>{{ appInfo.database }}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-icon name="cloud-offline-outline" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>Última Sincronización</h3>
              <p>{{ appInfo.lastSync }}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h3>Almacenamiento Usado</h3>
              <p>{{ appInfo.storageUsed }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Información legal -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Información Legal</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p class="legal-text">
          <strong>AGRODATA - Sistema de Control Bovino</strong><br>
          Desarrollado para la gestión integral del ganado bovino.<br><br>
          
          Esta aplicación funciona completamente offline y todos los datos se almacenan localmente en el dispositivo.<br><br>
          
          © 2025 - Todos los derechos reservados
        </p>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
